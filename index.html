<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RDO Profissional - ForAll Engenharia</title>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <style>
        :root { 
            --primary: #1d3557; 
            --secondary: #457b9d; 
        }
        
        /* ========== ESTILOS PARA TELA ========== */
        * { 
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body { 
            font-family: Arial, sans-serif; 
            background: #f4f4f4; 
            margin: 0; 
            padding: 20px 0;
        }
        
        /* Container Principal */
        #pdf-content { 
            background: white; 
            width: 210mm; 
            margin: 0 auto; 
            padding: 15mm; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        /* Cabe√ßalho */
        .header { 
            display: flex; 
            align-items: center; 
            border-bottom: 2px solid var(--primary); 
            padding-bottom: 10px; 
            margin-bottom: 20px;
        }
        
        .logo { 
            width: 140px; 
            height: auto;
            margin-right: 20px;
        }
        
        .empresa-info { 
            font-size: 10px; 
            flex-grow: 1; 
            line-height: 1.6; 
            color: #333; 
        }
        
        .doc-title { 
            text-align: right; 
            color: var(--primary); 
            font-weight: bold; 
            font-size: 16px;
        }

        /* Se√ß√µes */
        .section-title { 
            background: var(--primary); 
            color: white; 
            padding: 8px 12px; 
            font-size: 12px; 
            margin-top: 20px; 
            margin-bottom: 10px;
            text-transform: uppercase; 
            font-weight: bold; 
            border-radius: 3px;
        }
        
        .grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            margin-bottom: 10px;
        }
        
        .full { 
            grid-column: span 2; 
        }
        
        label { 
            display: block; 
            font-size: 10px; 
            font-weight: bold; 
            color: var(--primary); 
            margin-bottom: 3px; 
        }
        
        .data-field { 
            border: 1px solid #ddd; 
            padding: 8px; 
            font-size: 12px; 
            min-height: 38px; 
            background: #fafafa; 
            border-radius: 3px;
            line-height: 1.4;
        }
        
        input, select, textarea { 
            width: 100%; 
            border: 1px solid #ccc; 
            padding: 8px; 
            font-size: 13px; 
            border-radius: 3px; 
            font-family: inherit; 
        }
        
        textarea {
            resize: vertical;
        }

        /* Registro Fotogr√°fico */
        #preview-container { 
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10mm; 
            margin-top: 15px;
            margin-bottom: 15px;
        }
        
        .photo-box { 
            width: 100%; 
            height: 65mm; 
            border: 1px solid #ddd; 
            overflow: hidden; 
            border-radius: 4px;
            background: #f9f9f9;
        }
        
        .photo-box img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover;
            display: block;
        }

        /* Assinaturas */
        .signature-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 30mm; 
            margin-top: 30px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .sig-wrapper { 
            border-bottom: 2px solid #000; 
            margin-bottom: 8px; 
            height: 100px;
        }
        
        canvas { 
            width: 100%; 
            height: 100px; 
            touch-action: none;
            cursor: crosshair;
        }
        
        .sig-label { 
            font-size: 11px; 
            color: #222;
            line-height: 1.4;
        }

        /* √Årea de Controle */
        .no-print-area { 
            max-width: 210mm; 
            margin: 15px auto; 
            background: #fff; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .controls { 
            position: fixed; 
            bottom: 30px; 
            left: 50%; 
            transform: translateX(-50%); 
            display: flex; 
            gap: 15px; 
            z-index: 1000;
            background: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        button { 
            padding: 12px 25px; 
            border: none; 
            border-radius: 25px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 14px;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .btn-pdf { 
            background: #27ae60; 
            color: white; 
        }
        
        .btn-clear { 
            background: #e74c3c; 
            color: white; 
        }
        
        .btn-limpar-sig {
            background: #95a5a6;
            color: white;
            font-size: 11px;
            padding: 5px 10px;
            margin-top: 5px;
        }

        /* ========== ESTILOS PARA IMPRESS√ÉO ========== */
        @media print {
            @page {
                size: A4;
                margin: 12mm;
            }
            
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            body {
                background: white;
                margin: 0;
                padding: 0;
            }
            
            #pdf-content {
                width: 100%;
                margin: 0;
                padding: 0;
                box-shadow: none;
            }
            
            /* Esconde elementos de controle */
            .no-print,
            .no-print-area,
            .controls,
            .btn-limpar-sig {
                display: none !important;
            }
            
            /* For√ßa impress√£o de cores de fundo */
            .section-title {
                background: var(--primary) !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            /* Controle de quebras de p√°gina */
            .header {
                page-break-after: avoid;
                break-after: avoid;
            }
            
            .section-title {
                page-break-after: avoid;
                break-after: avoid;
                page-break-before: auto;
                break-before: auto;
            }
            
            .grid {
                page-break-inside: avoid;
                break-inside: avoid;
            }
            
            .photo-box {
                page-break-inside: avoid;
                break-inside: avoid;
                page-break-after: auto;
                break-after: auto;
            }
            
            .signature-grid {
                page-break-inside: avoid;
                break-inside: avoid;
                margin-top: 20mm;
            }
            
            /* Garante que imagens sejam impressas */
            img {
                max-width: 100%;
                page-break-inside: avoid;
            }
            
            /* Ajusta canvas para impress√£o */
            canvas {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>

<!-- √ÅREA DE CADASTRO (N√ÉO IMPRIME) -->
<div class="no-print-area">
    <h3 style="margin-bottom: 15px; color: var(--primary);">‚öôÔ∏è Gest√£o de Obras (ForAll)</h3>
    <div class="grid">
        <input type="text" id="cadObra" placeholder="Apelido da Obra">
        <input type="text" id="cadContrato" placeholder="N¬∫ Contrato">
        <input type="text" id="cadEmpresa" placeholder="Empresa Contratada">
        <input type="text" id="cadObjeto" placeholder="Objeto Completo">
        <input type="date" id="cadInicio" placeholder="Data In√≠cio">
        <input type="date" id="cadTermino" placeholder="Previs√£o T√©rmino">
    </div>
    <button style="background: var(--secondary); color: white; width: 100%; margin-top: 10px;" onclick="salvarNovaObra()">
        ‚ûï Cadastrar Obra
    </button>
</div>

<!-- CONTE√öDO DO PDF -->
<div id="pdf-content">
    <!-- CABE√áALHO -->
    <div class="header">
        <img src="https://forallengenharia.com.br/images/logo_original.svg" class="logo" alt="Logo ForAll Engenharia">
        <div class="empresa-info">
            <strong>FORALL ENGENHARIA LTDA</strong><br>
            CNPJ 47.418.779/0001-23<br>
            Holambra e regi√£o - SP | (19) 99624-3591<br>
            contato@forallengenharia.com.br
        </div>
        <div class="doc-title">DI√ÅRIO DE OBRA</div>
    </div>

    <!-- DADOS DO CONTRATO -->
    <div class="section-title">Dados do Contrato</div>
    <div class="grid">
        <div class="full no-print">
            <label>Selecione a Obra:</label>
            <select id="seletorObra" onchange="carregarDadosObra(this.value)">
                <option value="">-- Escolha uma obra cadastrada --</option>
            </select>
        </div>
        <div class="full">
            <label>Objeto/Obra:</label>
            <div id="outObjeto" class="data-field"></div>
        </div>
        <div>
            <label>N¬∫ Contrato:</label>
            <div id="outContrato" class="data-field"></div>
        </div>
        <div>
            <label>Empresa:</label>
            <div id="outEmpresa" class="data-field"></div>
        </div>
        <div>
            <label>Data In√≠cio:</label>
            <div id="outInicio" class="data-field"></div>
        </div>
        <div>
            <label>Previs√£o T√©rmino:</label>
            <div id="outTermino" class="data-field"></div>
        </div>
    </div>

    <!-- RELAT√ìRIO DE VISITA -->
    <div class="section-title">Relat√≥rio de Visita</div>
    <div class="grid">
        <div>
            <label>Data:</label>
            <input type="date" id="dataAtual">
        </div>
        <div>
            <label>Clima:</label>
            <select id="clima">
                <option>Ensolarado</option>
                <option>Nublado</option>
                <option>Chuvoso (Trabalh√°vel)</option>
                <option>Chuvoso (Interrompido)</option>
            </select>
        </div>
        <div>
            <label>Efetivo (Funcion√°rios):</label>
            <input type="number" id="efetivo" min="0">
        </div>
        <div class="full">
            <label>Atividades em Execu√ß√£o:</label>
            <textarea id="atividades" rows="4" placeholder="Descreva as atividades realizadas no dia..."></textarea>
        </div>
        <div class="full">
            <label>Observa√ß√µes:</label>
            <textarea id="obs" rows="3" placeholder="Observa√ß√µes gerais, pend√™ncias, etc..."></textarea>
        </div>
    </div>

    <!-- REGISTRO FOTOGR√ÅFICO -->
    <div class="section-title">Registro Fotogr√°fico</div>
    <div class="no-print" style="padding: 10px 0;">
        <input type="file" id="fotos" accept="image/*" multiple onchange="previewImages()">
        <small style="color: #666; font-size: 11px;">Selecione uma ou mais imagens (m√°ximo recomendado: 6 fotos)</small>
    </div>
    <div id="preview-container"></div>

    <!-- ASSINATURAS -->
    <div class="signature-grid">
        <div>
            <div class="sig-wrapper">
                <canvas id="sig-proponente"></canvas>
            </div>
            <button class="btn-limpar-sig no-print" onclick="limparAssinatura('proponente')">üóëÔ∏è Limpar</button>
            <div class="sig-label">Fiscaliza√ß√£o / Proponente</div>
        </div>
        <div>
            <div class="sig-wrapper">
                <canvas id="sig-germano"></canvas>
            </div>
            <button class="btn-limpar-sig no-print" onclick="limparAssinatura('germano')">üóëÔ∏è Limpar</button>
            <div class="sig-label">
                <strong>Germano Jorge Francisco</strong><br>
                Eng. Civil | CREA-SP 506.968.487-8
            </div>
        </div>
    </div>
</div>

<!-- CONTROLES FLUTUANTES -->
<div class="controls">
    <button class="btn-clear" onclick="limparTudo()">üóëÔ∏è Limpar Tudo</button>
    <button class="btn-pdf" onclick="imprimirPDF()">üìÑ IMPRIMIR PDF</button>
</div>

<script>
    // Vari√°veis globais
    let obras = [];
    let padProp, padGerm;

    // Inicializa√ß√£o
    window.onload = () => {
        // Define data atual
        document.getElementById('dataAtual').valueAsDate = new Date();
        
        // Inicializa signature pads
        padProp = new SignaturePad(document.getElementById('sig-proponente'), {
            backgroundColor: 'rgb(255, 255, 255)',
            penColor: 'rgb(0, 0, 0)'
        });
        
        padGerm = new SignaturePad(document.getElementById('sig-germano'), {
            backgroundColor: 'rgb(255, 255, 255)',
            penColor: 'rgb(0, 0, 0)'
        });
        
        atualizarSeletor();
    };

    // Gerenciamento de obras
    function salvarNovaObra() {
        const nova = {
            id: Date.now(),
            nome: document.getElementById('cadObra').value.trim(),
            contrato: document.getElementById('cadContrato').value.trim(),
            empresa: document.getElementById('cadEmpresa').value.trim(),
            objeto: document.getElementById('cadObjeto').value.trim(),
            inicio: document.getElementById('cadInicio').value,
            termino: document.getElementById('cadTermino').value
        };
        
        if(!nova.nome) {
            alert("‚ö†Ô∏è Insira o nome/apelido da obra");
            return;
        }
        
        obras.push(nova);
        atualizarSeletor();
        
        // Limpa campos
        document.getElementById('cadObra').value = '';
        document.getElementById('cadContrato').value = '';
        document.getElementById('cadEmpresa').value = '';
        document.getElementById('cadObjeto').value = '';
        document.getElementById('cadInicio').value = '';
        document.getElementById('cadTermino').value = '';
        
        alert("‚úÖ Obra cadastrada com sucesso!");
    }

    function atualizarSeletor() {
        const select = document.getElementById('seletorObra');
        select.innerHTML = '<option value="">-- Escolha uma obra cadastrada --</option>';
        obras.forEach(o => {
            select.innerHTML += `<option value="${o.id}">${o.nome}</option>`;
        });
    }

    function carregarDadosObra(id) {
        if(!id) return;
        
        const obra = obras.find(o => o.id == id);
        if(obra) {
            document.getElementById('outObjeto').innerText = obra.objeto;
            document.getElementById('outContrato').innerText = obra.contrato;
            document.getElementById('outEmpresa').innerText = obra.empresa;
            document.getElementById('outInicio').innerText = formatarData(obra.inicio);
            document.getElementById('outTermino').innerText = formatarData(obra.termino);
        }
    }

    function formatarData(data) {
        if(!data) return '';
        const [ano, mes, dia] = data.split('-');
        return `${dia}/${mes}/${ano}`;
    }

    // Gerenciamento de fotos
    function previewImages() {
        const container = document.getElementById('preview-container');
        const files = document.getElementById('fotos').files;
        
        container.innerHTML = '';
        
        if(files.length > 6) {
            alert("‚ö†Ô∏è Recomendamos no m√°ximo 6 fotos para melhor formata√ß√£o no PDF");
        }
        
        Array.from(files).forEach(file => {
            const reader = new FileReader();
            reader.onload = e => {
                const div = document.createElement('div');
                div.className = 'photo-box';
                div.innerHTML = `<img src="${e.target.result}" alt="Foto da obra">`;
                container.appendChild(div);
            };
            reader.readAsDataURL(file);
        });
    }

    // Gerenciamento de assinaturas
    function limparAssinatura(tipo) {
        if(tipo === 'proponente') {
            padProp.clear();
        } else {
            padGerm.clear();
        }
    }

    // Fun√ß√£o de impress√£o
    function imprimirPDF() {
        // Valida√ß√µes b√°sicas
        if(!document.getElementById('outObjeto').innerText) {
            alert("‚ö†Ô∏è Selecione uma obra antes de gerar o PDF");
            return;
        }
        
        // Abre di√°logo de impress√£o do navegador
        window.print();
    }

    function limparTudo() {
        if(confirm("‚ö†Ô∏è Deseja realmente limpar todos os dados? Esta a√ß√£o n√£o pode ser desfeita.")) {
            window.location.reload();
        }
    }
</script>

</body>
</html>
